<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fütterung erfassen</title>
<style>
body{font-family:Arial, sans-serif;margin:1rem}
label{display:block;margin-top:0.6rem}
input,select,button{padding:0.45rem;margin-top:0.3rem;width:100%;max-width:260px}
table{border-collapse:collapse;margin-top:1rem;width:100%}
th,td{border:1px solid #ccc;padding:0.4rem;text-align:left}
th{background:#f0f0f0}
.result{margin-top:1rem;font-weight:bold}
</style>
</head>
<body>

<h1>Fütterung erfassen1</h1>

<label>Ration auswählen</label>
<select id="rationSelect"></select>

<label>Anzahl Tiere</label>
<input type="number" id="anzahl" />

<label>Korrekturfaktor (%)</label>
<input type="number" id="faktor" />

<button onclick="speichern()">Fütterung dokumentieren</button>

<h2>Zu fütternde Frischmasse (kg)</h2>
<table>
<thead><tr><th>Komponente</th><th>kg</th></tr></thead>
<tbody id="resultTable"></tbody>
</table>

<form id="fuetterForm" method="POST" action="https://docs.google.com/forms/d/e/1FAIpQLSe3xysbA5uxgEGDRy_lJAF2ZEDofJavgEXTlrz1POBcwMY3yw/formResponse" target="hidden_iframe">
  <input type="hidden" name="entry.690290440" id="formRation">
  <input type="hidden" name="entry.1406564399" id="formAnzahl">
  <input type="hidden" name="entry.373869795" id="formFaktor">
</form>
<iframe name="hidden_iframe" style="display:none;"></iframe>

<script>
// ===== CSV LINKS =====
const rationCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3X2pqe0ycs2bDCTIgJA-KyXbzR80hCPK0TPgM7C6fyUh_xflB_Ry2PVu2BD_lbzBSgv2YVrxFec-v/pub?gid=0&single=true&output=csv";
const tsCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3X2pqe0ycs2bDCTIgJA-KyXbzR80hCPK0TPgM7C6fyUh_xflB_Ry2PVu2BD_lbzBSgv2YVrxFec-v/pub?gid=267748514&single=true&output=csv";
const fuetterCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3X2pqe0ycs2bDCTIgJA-KyXbzR80hCPK0TPgM7C6fyUh_xflB_Ry2PVu2BD_lbzBSgv2YVrxFec-v/pub?gid=1853046882&single=true&output=csv";

let rationen = {}, tsWerte = {}, letzte = {};

async function loadCSV(url){
  const resp = await fetch(url);
  return await resp.text();
}

function parseCSV(text){
  return text.trim().split("\n").map(r=>r.split(",").map(c=>c.trim()));
}

async function init(){
  // Rationen
  const rtext = await loadCSV(rationCSV);
  const rrows = parseCSV(rtext);
  const headers = rrows[0];
  for(let i=1;i<rrows.length;i++){
    const name = rrows[i][0];
    if(name){
      rationen[name]={};
      for(let j=1;j<headers.length;j++){
        const val=parseFloat(rrows[i][j]);
        if(!isNaN(val) && val>0) rationen[name][headers[j].trim()] = val;
      }
    }
  }

  // TS
  const ttext = await loadCSV(tsCSV);
  const trows = parseCSV(ttext);
  for(let i=1;i<tro
